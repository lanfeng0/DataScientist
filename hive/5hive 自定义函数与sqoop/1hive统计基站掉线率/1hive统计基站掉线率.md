1.

2月份基站掉线率top3

2月份每基站每天通话总时长

### 原始数据

字段说明：

时间，基站ID，手机号，通话时间（秒），掉话时间（秒）

\[hadoop@h201 hhh\]\$ vi cell2.txt

2020-01-11,10001,13912345678,123,0

2020-01-11,10002,13512345678,123,0

2020-01-11,10001,13812345678,123,10

2020-01-11,10001,13722345671,123,5

2020-02-11,10001,13912345678,125,0

2020-02-12,10001,13912345678,128,5

2020-02-11,10001,13912345678,125,2

2020-02-12,10001,13912345678,10,0

2020-02-13,10001,13912345678,55,0

2020-02-12,10001,13912345678,19,5

2020-02-11,10001,13912345678,20,0

2020-02-12,10001,13912345678,290,0

2020-01-11,10001,13912345678,123,0

2020-01-11,10002,13512345678,123,0

2020-01-11,10001,13812345678,123,10

2020-01-11,10001,13722345671,123,5

2020-02-11,10002,13912345678,125,0

2020-02-12,10002,13912345678,128,5

2020-02-11,10002,13912345678,801,0

2020-02-12,10002,13912345678,10,0

2020-02-13,10001,13912345678,55,0

2020-02-12,10001,13912345678,19,5

2020-02-11,10003,13922345678,20,0

2020-02-12,10003,13999999678,290,0

2020-02-12,10003,13999999999,69,19

2020-02-11,10002,13912345678,125,0

2020-02-12,10002,13912345678,128,5

2020-02-11,10002,13912345678,801,0

2020-02-12,10002,13912345678,10,0

2020-02-13,10005,139125555578,155,50

2020-02-12,10005,13912345678,19,5

2020-02-11,10005,13922345678,20,6

2020-02-12,10004,13777779678,290,0

2020-02-12,10004,13899999999,69,0

(2) 创建表

    create table cell2(

    rtime string,

    imei string,

    ph\_num bigint,

    call\_num int,

    drop\_num int)

    row format delimited fields terminated by ','

    stored as textfile;

(3) 导入数据

    hive&gt; load data local inpath '/home/hadoop/hhh/cell2.txt' into
    table cell2;

(4) 创建结果表

    create table cell123(

    imei string,

    total\_call\_num int,

    total\_drop\_num int,

    d\_rate double,

    mdate string)

    row format delimited fields terminated by ',';

### 开发

（1）统计2月份每基站掉线率top3的基站

select a.imei,(a.d\_sum/a.c\_sum) as d\_rate from

(select substring(rtime,1,7) as r1,imei,sum(call\_num) as
c\_sum,sum(drop\_num) as d\_sum from cell2 group by
substring(rtime,1,7),imei) a where a.r1='2020-02' and a.c\_sum&lt;&gt;0
order by d\_rate desc limit 3;

结果：

a.imei d\_rate

10005 0.31443298969072164

10003 0.05013192612137203

10001 0.02009456264775414

（2）统计2月份每基站每天总通话时长的排名

hive&gt; select rtime,imei,sum(call\_num) as s\_call from cell2 where
substring(rtime,1,7) ='2020-02' group by rtime,imei order by s\_call
desc;

结果：

2020-02-11 10002 1852

2020-02-12 10001 466

2020-02-12 10004 359

2020-02-12 10003 359

2020-02-12 10002 276

2020-02-11 10001 270

2020-02-13 10005 155

2020-02-13 10001 110

2020-02-11 10005 20

2020-02-11 10003 20

2020-02-12 10005 19
