

```python
import numpy as np
import pandas as pd
from pandas import Series,DataFrame
```


```python
# 首先导入文件，并查看数据样本
```


```python
pop = pd.read_csv('../data/state-population.csv')
areas = pd.read_csv('../data/state-areas.csv')
abbrevs = pd.read_csv('../data/state-abbrevs.csv')
display(pop.head(),areas.head(),abbrevs.head())
```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state/region</th>
      <th>ages</th>
      <th>year</th>
      <th>population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AL</td>
      <td>under18</td>
      <td>2012</td>
      <td>1117489.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AL</td>
      <td>total</td>
      <td>2012</td>
      <td>4817528.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AL</td>
      <td>under18</td>
      <td>2010</td>
      <td>1130966.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AL</td>
      <td>total</td>
      <td>2010</td>
      <td>4785570.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AL</td>
      <td>under18</td>
      <td>2011</td>
      <td>1125763.0</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>area (sq. mi)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>52423</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alaska</td>
      <td>656425</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arizona</td>
      <td>114006</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arkansas</td>
      <td>53182</td>
    </tr>
    <tr>
      <th>4</th>
      <td>California</td>
      <td>163707</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state</th>
      <th>abbreviation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Alabama</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Alaska</td>
      <td>AK</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Arizona</td>
      <td>AZ</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Arkansas</td>
      <td>AR</td>
    </tr>
    <tr>
      <th>4</th>
      <td>California</td>
      <td>CA</td>
    </tr>
  </tbody>
</table>
</div>



```python
# 合并pop与abbrevs两个DataFrame，分别依据state/region列和abbreviation列来合并。
# 为了保留所有信息，使用外合并
```


```python
merged = pd.merge(pop,abbrevs,how='outer',left_on = 'state/region',right_on = 'abbreviation')
merged2 = pd.merge(pop,abbrevs,left_on = 'state/region',right_on = 'abbreviation')
display(merged.head(),merged2.head())

```


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state/region</th>
      <th>ages</th>
      <th>year</th>
      <th>population</th>
      <th>state</th>
      <th>abbreviation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AL</td>
      <td>under18</td>
      <td>2012</td>
      <td>1117489.0</td>
      <td>Alabama</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AL</td>
      <td>total</td>
      <td>2012</td>
      <td>4817528.0</td>
      <td>Alabama</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AL</td>
      <td>under18</td>
      <td>2010</td>
      <td>1130966.0</td>
      <td>Alabama</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AL</td>
      <td>total</td>
      <td>2010</td>
      <td>4785570.0</td>
      <td>Alabama</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AL</td>
      <td>under18</td>
      <td>2011</td>
      <td>1125763.0</td>
      <td>Alabama</td>
      <td>AL</td>
    </tr>
  </tbody>
</table>
</div>



<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state/region</th>
      <th>ages</th>
      <th>year</th>
      <th>population</th>
      <th>state</th>
      <th>abbreviation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AL</td>
      <td>under18</td>
      <td>2012</td>
      <td>1117489.0</td>
      <td>Alabama</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AL</td>
      <td>total</td>
      <td>2012</td>
      <td>4817528.0</td>
      <td>Alabama</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AL</td>
      <td>under18</td>
      <td>2010</td>
      <td>1130966.0</td>
      <td>Alabama</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AL</td>
      <td>total</td>
      <td>2010</td>
      <td>4785570.0</td>
      <td>Alabama</td>
      <td>AL</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AL</td>
      <td>under18</td>
      <td>2011</td>
      <td>1125763.0</td>
      <td>Alabama</td>
      <td>AL</td>
    </tr>
  </tbody>
</table>
</div>



```python
# 去除abbreviation的那一列（axis=1）
```


```python
merged = merged.drop('abbreviation',axis = 1)
merged.head()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state/region</th>
      <th>ages</th>
      <th>year</th>
      <th>population</th>
      <th>state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AL</td>
      <td>under18</td>
      <td>2012</td>
      <td>1117489.0</td>
      <td>Alabama</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AL</td>
      <td>total</td>
      <td>2012</td>
      <td>4817528.0</td>
      <td>Alabama</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AL</td>
      <td>under18</td>
      <td>2010</td>
      <td>1130966.0</td>
      <td>Alabama</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AL</td>
      <td>total</td>
      <td>2010</td>
      <td>4785570.0</td>
      <td>Alabama</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AL</td>
      <td>under18</td>
      <td>2011</td>
      <td>1125763.0</td>
      <td>Alabama</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 查看存在缺失数据的列。
# 使用.isnull().any()，只有某一列存在一个缺失数据，就会显示True。
```


```python
merged.isnull().any()
```




    state/region    False
    ages            False
    year            False
    population       True
    state            True
    dtype: bool




```python
# 查看缺失数据的例子
```


```python
merged.shape
```




    (2544, 5)




```python
# 
display(merged['population'].isnull())
# 查看列population 缺失数据 如果缺失返回null
merged[merged['population'].isnull()] 
#根据数据是否缺失情况显示数据，如果缺失为True，那么显示
```


    0       False
    1       False
    2       False
    3       False
    4       False
    5       False
    6       False
    7       False
    8       False
    9       False
    10      False
    11      False
    12      False
    13      False
    14      False
    15      False
    16      False
    17      False
    18      False
    19      False
    20      False
    21      False
    22      False
    23      False
    24      False
    25      False
    26      False
    27      False
    28      False
    29      False
            ...  
    2514    False
    2515    False
    2516    False
    2517    False
    2518    False
    2519    False
    2520    False
    2521    False
    2522    False
    2523    False
    2524    False
    2525    False
    2526    False
    2527    False
    2528    False
    2529    False
    2530    False
    2531    False
    2532    False
    2533    False
    2534    False
    2535    False
    2536    False
    2537    False
    2538    False
    2539    False
    2540    False
    2541    False
    2542    False
    2543    False
    Name: population, Length: 2544, dtype: bool





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state/region</th>
      <th>ages</th>
      <th>year</th>
      <th>population</th>
      <th>state</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2448</th>
      <td>PR</td>
      <td>under18</td>
      <td>1990</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2449</th>
      <td>PR</td>
      <td>total</td>
      <td>1990</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2450</th>
      <td>PR</td>
      <td>total</td>
      <td>1991</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2451</th>
      <td>PR</td>
      <td>under18</td>
      <td>1991</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2452</th>
      <td>PR</td>
      <td>total</td>
      <td>1993</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2453</th>
      <td>PR</td>
      <td>under18</td>
      <td>1993</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2454</th>
      <td>PR</td>
      <td>under18</td>
      <td>1992</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2455</th>
      <td>PR</td>
      <td>total</td>
      <td>1992</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2456</th>
      <td>PR</td>
      <td>under18</td>
      <td>1994</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2457</th>
      <td>PR</td>
      <td>total</td>
      <td>1994</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2458</th>
      <td>PR</td>
      <td>total</td>
      <td>1995</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2459</th>
      <td>PR</td>
      <td>under18</td>
      <td>1995</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2460</th>
      <td>PR</td>
      <td>under18</td>
      <td>1996</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2461</th>
      <td>PR</td>
      <td>total</td>
      <td>1996</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2462</th>
      <td>PR</td>
      <td>under18</td>
      <td>1998</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2463</th>
      <td>PR</td>
      <td>total</td>
      <td>1998</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2464</th>
      <td>PR</td>
      <td>total</td>
      <td>1997</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2465</th>
      <td>PR</td>
      <td>under18</td>
      <td>1997</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2466</th>
      <td>PR</td>
      <td>total</td>
      <td>1999</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2467</th>
      <td>PR</td>
      <td>under18</td>
      <td>1999</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 找到有哪些state/region使得state的值为NaN，使用unique()去重
```


```python
# merged.loc[merged['state'].isnull(),'state/region'].unique()
# merged[merged['state'].isnull(),'state/region']# 出问题
# merged[merged['state'].isnull()]
# 注意：这里可以参考查看Excel表格中发现state/region 值为PR、USA在state-abbrevs中找不到对应的缩写
s = merged.loc[merged['state'].isnull(),'state/region']
ss = s.unique()
display(s,ss)
```


    2448     PR
    2449     PR
    2450     PR
    2451     PR
    2452     PR
    2453     PR
    2454     PR
    2455     PR
    2456     PR
    2457     PR
    2458     PR
    2459     PR
    2460     PR
    2461     PR
    2462     PR
    2463     PR
    2464     PR
    2465     PR
    2466     PR
    2467     PR
    2468     PR
    2469     PR
    2470     PR
    2471     PR
    2472     PR
    2473     PR
    2474     PR
    2475     PR
    2476     PR
    2477     PR
           ... 
    2514    USA
    2515    USA
    2516    USA
    2517    USA
    2518    USA
    2519    USA
    2520    USA
    2521    USA
    2522    USA
    2523    USA
    2524    USA
    2525    USA
    2526    USA
    2527    USA
    2528    USA
    2529    USA
    2530    USA
    2531    USA
    2532    USA
    2533    USA
    2534    USA
    2535    USA
    2536    USA
    2537    USA
    2538    USA
    2539    USA
    2540    USA
    2541    USA
    2542    USA
    2543    USA
    Name: state/region, Length: 96, dtype: object



    array(['PR', 'USA'], dtype=object)



```python
# 为找到的这些state/region的state项补上正确的值，从而去除掉state这一列的所有NaN！
# 记住这样清除缺失数据NaN的方法！
```


```python
merged.loc[merged['state/region']=='PR','state'] = 'Puerto Rico'
merged.loc[merged['state/region']=='USA','state'] = 'United States'
merged.isnull().any()
```




    state/region    False
    ages            False
    year            False
    population       True
    state           False
    dtype: bool




```python
merged.shape
```




    (2544, 5)




```python
# 合并各州面积数据areas，使用左合并。
# 思考一下为什么使用左合并？一般使用外合并、左合并，目的只有一个：宁愿该列是NaN也不要丢弃其他列的信息
```


```python
merged.isnull().any()
```




    state/region    False
    ages            False
    year            False
    population       True
    state           False
    dtype: bool




```python
display(merged.shape,areas.shape)
df1 = pd.merge(merged,areas,on = 'state')
df2 = pd.merge(merged,areas,on = 'state',how = 'left')
display(df1.shape,df2.shape)
# 注意：这里areas中没有USA所以加上how='left'
```


    (2544, 5)



    (52, 2)



    (2496, 6)



    (2544, 6)



```python
# 继续寻找存在缺失数据的列
```


```python
df2.isnull().any()
```




    state/region     False
    ages             False
    year             False
    population        True
    state            False
    area (sq. mi)     True
    dtype: bool




```python
# 我们会发现area(sq.mi)这一列有缺失数据，为了找出是哪一行，我们需要找出是哪个state没有数据
```


```python
df2
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state/region</th>
      <th>ages</th>
      <th>year</th>
      <th>population</th>
      <th>state</th>
      <th>area (sq. mi)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>AL</td>
      <td>under18</td>
      <td>2012</td>
      <td>1117489.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>AL</td>
      <td>total</td>
      <td>2012</td>
      <td>4817528.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>AL</td>
      <td>under18</td>
      <td>2010</td>
      <td>1130966.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>AL</td>
      <td>total</td>
      <td>2010</td>
      <td>4785570.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>AL</td>
      <td>under18</td>
      <td>2011</td>
      <td>1125763.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>AL</td>
      <td>total</td>
      <td>2011</td>
      <td>4801627.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>AL</td>
      <td>total</td>
      <td>2009</td>
      <td>4757938.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>AL</td>
      <td>under18</td>
      <td>2009</td>
      <td>1134192.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>AL</td>
      <td>under18</td>
      <td>2013</td>
      <td>1111481.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>AL</td>
      <td>total</td>
      <td>2013</td>
      <td>4833722.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>AL</td>
      <td>total</td>
      <td>2007</td>
      <td>4672840.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>AL</td>
      <td>under18</td>
      <td>2007</td>
      <td>1132296.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>AL</td>
      <td>total</td>
      <td>2008</td>
      <td>4718206.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>AL</td>
      <td>under18</td>
      <td>2008</td>
      <td>1134927.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>AL</td>
      <td>total</td>
      <td>2005</td>
      <td>4569805.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>AL</td>
      <td>under18</td>
      <td>2005</td>
      <td>1117229.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>AL</td>
      <td>total</td>
      <td>2006</td>
      <td>4628981.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>AL</td>
      <td>under18</td>
      <td>2006</td>
      <td>1126798.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>AL</td>
      <td>total</td>
      <td>2004</td>
      <td>4530729.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>AL</td>
      <td>under18</td>
      <td>2004</td>
      <td>1113662.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>AL</td>
      <td>total</td>
      <td>2003</td>
      <td>4503491.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>AL</td>
      <td>under18</td>
      <td>2003</td>
      <td>1113083.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>AL</td>
      <td>total</td>
      <td>2001</td>
      <td>4467634.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>AL</td>
      <td>under18</td>
      <td>2001</td>
      <td>1120409.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>AL</td>
      <td>total</td>
      <td>2002</td>
      <td>4480089.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>AL</td>
      <td>under18</td>
      <td>2002</td>
      <td>1116590.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>26</th>
      <td>AL</td>
      <td>under18</td>
      <td>1999</td>
      <td>1121287.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>27</th>
      <td>AL</td>
      <td>total</td>
      <td>1999</td>
      <td>4430141.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>AL</td>
      <td>total</td>
      <td>2000</td>
      <td>4452173.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>29</th>
      <td>AL</td>
      <td>under18</td>
      <td>2000</td>
      <td>1122273.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2514</th>
      <td>USA</td>
      <td>under18</td>
      <td>1999</td>
      <td>71946051.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2515</th>
      <td>USA</td>
      <td>total</td>
      <td>2000</td>
      <td>282162411.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2516</th>
      <td>USA</td>
      <td>under18</td>
      <td>2000</td>
      <td>72376189.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2517</th>
      <td>USA</td>
      <td>total</td>
      <td>1999</td>
      <td>279040181.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2518</th>
      <td>USA</td>
      <td>total</td>
      <td>2001</td>
      <td>284968955.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2519</th>
      <td>USA</td>
      <td>under18</td>
      <td>2001</td>
      <td>72671175.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2520</th>
      <td>USA</td>
      <td>total</td>
      <td>2002</td>
      <td>287625193.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2521</th>
      <td>USA</td>
      <td>under18</td>
      <td>2002</td>
      <td>72936457.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2522</th>
      <td>USA</td>
      <td>total</td>
      <td>2003</td>
      <td>290107933.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2523</th>
      <td>USA</td>
      <td>under18</td>
      <td>2003</td>
      <td>73100758.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2524</th>
      <td>USA</td>
      <td>total</td>
      <td>2004</td>
      <td>292805298.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2525</th>
      <td>USA</td>
      <td>under18</td>
      <td>2004</td>
      <td>73297735.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2526</th>
      <td>USA</td>
      <td>total</td>
      <td>2005</td>
      <td>295516599.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2527</th>
      <td>USA</td>
      <td>under18</td>
      <td>2005</td>
      <td>73523669.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2528</th>
      <td>USA</td>
      <td>total</td>
      <td>2006</td>
      <td>298379912.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2529</th>
      <td>USA</td>
      <td>under18</td>
      <td>2006</td>
      <td>73757714.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2530</th>
      <td>USA</td>
      <td>total</td>
      <td>2007</td>
      <td>301231207.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2531</th>
      <td>USA</td>
      <td>under18</td>
      <td>2007</td>
      <td>74019405.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2532</th>
      <td>USA</td>
      <td>total</td>
      <td>2008</td>
      <td>304093966.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2533</th>
      <td>USA</td>
      <td>under18</td>
      <td>2008</td>
      <td>74104602.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2534</th>
      <td>USA</td>
      <td>under18</td>
      <td>2013</td>
      <td>73585872.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2535</th>
      <td>USA</td>
      <td>total</td>
      <td>2013</td>
      <td>316128839.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2536</th>
      <td>USA</td>
      <td>total</td>
      <td>2009</td>
      <td>306771529.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2537</th>
      <td>USA</td>
      <td>under18</td>
      <td>2009</td>
      <td>74134167.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2538</th>
      <td>USA</td>
      <td>under18</td>
      <td>2010</td>
      <td>74119556.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2539</th>
      <td>USA</td>
      <td>total</td>
      <td>2010</td>
      <td>309326295.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2540</th>
      <td>USA</td>
      <td>under18</td>
      <td>2011</td>
      <td>73902222.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2541</th>
      <td>USA</td>
      <td>total</td>
      <td>2011</td>
      <td>311582564.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2542</th>
      <td>USA</td>
      <td>under18</td>
      <td>2012</td>
      <td>73708179.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2543</th>
      <td>USA</td>
      <td>total</td>
      <td>2012</td>
      <td>313873685.0</td>
      <td>United States</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>2544 rows × 6 columns</p>
</div>




```python
s1 = df2['state'][df2['area (sq. mi)'].isnull()]
display(s1.shape)
display(s1)
```


    (48,)



    2496    United States
    2497    United States
    2498    United States
    2499    United States
    2500    United States
    2501    United States
    2502    United States
    2503    United States
    2504    United States
    2505    United States
    2506    United States
    2507    United States
    2508    United States
    2509    United States
    2510    United States
    2511    United States
    2512    United States
    2513    United States
    2514    United States
    2515    United States
    2516    United States
    2517    United States
    2518    United States
    2519    United States
    2520    United States
    2521    United States
    2522    United States
    2523    United States
    2524    United States
    2525    United States
    2526    United States
    2527    United States
    2528    United States
    2529    United States
    2530    United States
    2531    United States
    2532    United States
    2533    United States
    2534    United States
    2535    United States
    2536    United States
    2537    United States
    2538    United States
    2539    United States
    2540    United States
    2541    United States
    2542    United States
    2543    United States
    Name: state, dtype: object



```python
# 去除含有缺失数据的行
```


```python
display(df2.shape,df2.dropna(inplace = True),df2.shape)

```


    (2544, 6)



    None



    (2476, 6)



```python
# 找出2010年的全民人口数据
```


```python
display(df2.shape,type(df2))
data2010 = df2.query("year == 2010 & ages == 'total'")
data2010
```


    (2476, 6)



    pandas.core.frame.DataFrame





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state/region</th>
      <th>ages</th>
      <th>year</th>
      <th>population</th>
      <th>state</th>
      <th>area (sq. mi)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>AL</td>
      <td>total</td>
      <td>2010</td>
      <td>4785570.0</td>
      <td>Alabama</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>91</th>
      <td>AK</td>
      <td>total</td>
      <td>2010</td>
      <td>713868.0</td>
      <td>Alaska</td>
      <td>656425.0</td>
    </tr>
    <tr>
      <th>101</th>
      <td>AZ</td>
      <td>total</td>
      <td>2010</td>
      <td>6408790.0</td>
      <td>Arizona</td>
      <td>114006.0</td>
    </tr>
    <tr>
      <th>189</th>
      <td>AR</td>
      <td>total</td>
      <td>2010</td>
      <td>2922280.0</td>
      <td>Arkansas</td>
      <td>53182.0</td>
    </tr>
    <tr>
      <th>197</th>
      <td>CA</td>
      <td>total</td>
      <td>2010</td>
      <td>37333601.0</td>
      <td>California</td>
      <td>163707.0</td>
    </tr>
    <tr>
      <th>283</th>
      <td>CO</td>
      <td>total</td>
      <td>2010</td>
      <td>5048196.0</td>
      <td>Colorado</td>
      <td>104100.0</td>
    </tr>
    <tr>
      <th>293</th>
      <td>CT</td>
      <td>total</td>
      <td>2010</td>
      <td>3579210.0</td>
      <td>Connecticut</td>
      <td>5544.0</td>
    </tr>
    <tr>
      <th>379</th>
      <td>DE</td>
      <td>total</td>
      <td>2010</td>
      <td>899711.0</td>
      <td>Delaware</td>
      <td>1954.0</td>
    </tr>
    <tr>
      <th>389</th>
      <td>DC</td>
      <td>total</td>
      <td>2010</td>
      <td>605125.0</td>
      <td>District of Columbia</td>
      <td>68.0</td>
    </tr>
    <tr>
      <th>475</th>
      <td>FL</td>
      <td>total</td>
      <td>2010</td>
      <td>18846054.0</td>
      <td>Florida</td>
      <td>65758.0</td>
    </tr>
    <tr>
      <th>485</th>
      <td>GA</td>
      <td>total</td>
      <td>2010</td>
      <td>9713248.0</td>
      <td>Georgia</td>
      <td>59441.0</td>
    </tr>
    <tr>
      <th>570</th>
      <td>HI</td>
      <td>total</td>
      <td>2010</td>
      <td>1363731.0</td>
      <td>Hawaii</td>
      <td>10932.0</td>
    </tr>
    <tr>
      <th>581</th>
      <td>ID</td>
      <td>total</td>
      <td>2010</td>
      <td>1570718.0</td>
      <td>Idaho</td>
      <td>83574.0</td>
    </tr>
    <tr>
      <th>666</th>
      <td>IL</td>
      <td>total</td>
      <td>2010</td>
      <td>12839695.0</td>
      <td>Illinois</td>
      <td>57918.0</td>
    </tr>
    <tr>
      <th>677</th>
      <td>IN</td>
      <td>total</td>
      <td>2010</td>
      <td>6489965.0</td>
      <td>Indiana</td>
      <td>36420.0</td>
    </tr>
    <tr>
      <th>762</th>
      <td>IA</td>
      <td>total</td>
      <td>2010</td>
      <td>3050314.0</td>
      <td>Iowa</td>
      <td>56276.0</td>
    </tr>
    <tr>
      <th>773</th>
      <td>KS</td>
      <td>total</td>
      <td>2010</td>
      <td>2858910.0</td>
      <td>Kansas</td>
      <td>82282.0</td>
    </tr>
    <tr>
      <th>858</th>
      <td>KY</td>
      <td>total</td>
      <td>2010</td>
      <td>4347698.0</td>
      <td>Kentucky</td>
      <td>40411.0</td>
    </tr>
    <tr>
      <th>869</th>
      <td>LA</td>
      <td>total</td>
      <td>2010</td>
      <td>4545392.0</td>
      <td>Louisiana</td>
      <td>51843.0</td>
    </tr>
    <tr>
      <th>954</th>
      <td>ME</td>
      <td>total</td>
      <td>2010</td>
      <td>1327366.0</td>
      <td>Maine</td>
      <td>35387.0</td>
    </tr>
    <tr>
      <th>965</th>
      <td>MD</td>
      <td>total</td>
      <td>2010</td>
      <td>5787193.0</td>
      <td>Maryland</td>
      <td>12407.0</td>
    </tr>
    <tr>
      <th>1050</th>
      <td>MA</td>
      <td>total</td>
      <td>2010</td>
      <td>6563263.0</td>
      <td>Massachusetts</td>
      <td>10555.0</td>
    </tr>
    <tr>
      <th>1061</th>
      <td>MI</td>
      <td>total</td>
      <td>2010</td>
      <td>9876149.0</td>
      <td>Michigan</td>
      <td>96810.0</td>
    </tr>
    <tr>
      <th>1146</th>
      <td>MN</td>
      <td>total</td>
      <td>2010</td>
      <td>5310337.0</td>
      <td>Minnesota</td>
      <td>86943.0</td>
    </tr>
    <tr>
      <th>1157</th>
      <td>MS</td>
      <td>total</td>
      <td>2010</td>
      <td>2970047.0</td>
      <td>Mississippi</td>
      <td>48434.0</td>
    </tr>
    <tr>
      <th>1242</th>
      <td>MO</td>
      <td>total</td>
      <td>2010</td>
      <td>5996063.0</td>
      <td>Missouri</td>
      <td>69709.0</td>
    </tr>
    <tr>
      <th>1253</th>
      <td>MT</td>
      <td>total</td>
      <td>2010</td>
      <td>990527.0</td>
      <td>Montana</td>
      <td>147046.0</td>
    </tr>
    <tr>
      <th>1338</th>
      <td>NE</td>
      <td>total</td>
      <td>2010</td>
      <td>1829838.0</td>
      <td>Nebraska</td>
      <td>77358.0</td>
    </tr>
    <tr>
      <th>1349</th>
      <td>NV</td>
      <td>total</td>
      <td>2010</td>
      <td>2703230.0</td>
      <td>Nevada</td>
      <td>110567.0</td>
    </tr>
    <tr>
      <th>1434</th>
      <td>NH</td>
      <td>total</td>
      <td>2010</td>
      <td>1316614.0</td>
      <td>New Hampshire</td>
      <td>9351.0</td>
    </tr>
    <tr>
      <th>1445</th>
      <td>NJ</td>
      <td>total</td>
      <td>2010</td>
      <td>8802707.0</td>
      <td>New Jersey</td>
      <td>8722.0</td>
    </tr>
    <tr>
      <th>1530</th>
      <td>NM</td>
      <td>total</td>
      <td>2010</td>
      <td>2064982.0</td>
      <td>New Mexico</td>
      <td>121593.0</td>
    </tr>
    <tr>
      <th>1541</th>
      <td>NY</td>
      <td>total</td>
      <td>2010</td>
      <td>19398228.0</td>
      <td>New York</td>
      <td>54475.0</td>
    </tr>
    <tr>
      <th>1626</th>
      <td>NC</td>
      <td>total</td>
      <td>2010</td>
      <td>9559533.0</td>
      <td>North Carolina</td>
      <td>53821.0</td>
    </tr>
    <tr>
      <th>1637</th>
      <td>ND</td>
      <td>total</td>
      <td>2010</td>
      <td>674344.0</td>
      <td>North Dakota</td>
      <td>70704.0</td>
    </tr>
    <tr>
      <th>1722</th>
      <td>OH</td>
      <td>total</td>
      <td>2010</td>
      <td>11545435.0</td>
      <td>Ohio</td>
      <td>44828.0</td>
    </tr>
    <tr>
      <th>1733</th>
      <td>OK</td>
      <td>total</td>
      <td>2010</td>
      <td>3759263.0</td>
      <td>Oklahoma</td>
      <td>69903.0</td>
    </tr>
    <tr>
      <th>1818</th>
      <td>OR</td>
      <td>total</td>
      <td>2010</td>
      <td>3837208.0</td>
      <td>Oregon</td>
      <td>98386.0</td>
    </tr>
    <tr>
      <th>1829</th>
      <td>PA</td>
      <td>total</td>
      <td>2010</td>
      <td>12710472.0</td>
      <td>Pennsylvania</td>
      <td>46058.0</td>
    </tr>
    <tr>
      <th>1914</th>
      <td>RI</td>
      <td>total</td>
      <td>2010</td>
      <td>1052669.0</td>
      <td>Rhode Island</td>
      <td>1545.0</td>
    </tr>
    <tr>
      <th>1925</th>
      <td>SC</td>
      <td>total</td>
      <td>2010</td>
      <td>4636361.0</td>
      <td>South Carolina</td>
      <td>32007.0</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>SD</td>
      <td>total</td>
      <td>2010</td>
      <td>816211.0</td>
      <td>South Dakota</td>
      <td>77121.0</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>TN</td>
      <td>total</td>
      <td>2010</td>
      <td>6356683.0</td>
      <td>Tennessee</td>
      <td>42146.0</td>
    </tr>
    <tr>
      <th>2106</th>
      <td>TX</td>
      <td>total</td>
      <td>2010</td>
      <td>25245178.0</td>
      <td>Texas</td>
      <td>268601.0</td>
    </tr>
    <tr>
      <th>2117</th>
      <td>UT</td>
      <td>total</td>
      <td>2010</td>
      <td>2774424.0</td>
      <td>Utah</td>
      <td>84904.0</td>
    </tr>
    <tr>
      <th>2202</th>
      <td>VT</td>
      <td>total</td>
      <td>2010</td>
      <td>625793.0</td>
      <td>Vermont</td>
      <td>9615.0</td>
    </tr>
    <tr>
      <th>2213</th>
      <td>VA</td>
      <td>total</td>
      <td>2010</td>
      <td>8024417.0</td>
      <td>Virginia</td>
      <td>42769.0</td>
    </tr>
    <tr>
      <th>2298</th>
      <td>WA</td>
      <td>total</td>
      <td>2010</td>
      <td>6742256.0</td>
      <td>Washington</td>
      <td>71303.0</td>
    </tr>
    <tr>
      <th>2309</th>
      <td>WV</td>
      <td>total</td>
      <td>2010</td>
      <td>1854146.0</td>
      <td>West Virginia</td>
      <td>24231.0</td>
    </tr>
    <tr>
      <th>2394</th>
      <td>WI</td>
      <td>total</td>
      <td>2010</td>
      <td>5689060.0</td>
      <td>Wisconsin</td>
      <td>65503.0</td>
    </tr>
    <tr>
      <th>2405</th>
      <td>WY</td>
      <td>total</td>
      <td>2010</td>
      <td>564222.0</td>
      <td>Wyoming</td>
      <td>97818.0</td>
    </tr>
    <tr>
      <th>2490</th>
      <td>PR</td>
      <td>total</td>
      <td>2010</td>
      <td>3721208.0</td>
      <td>Puerto Rico</td>
      <td>3515.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 对查询结果进行处理，以state列作为新的行索引
```


```python
data2010.set_index('state',inplace=True)
display(data2010.shape)
data2010.head()
```


    (52, 5)





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>state/region</th>
      <th>ages</th>
      <th>year</th>
      <th>population</th>
      <th>area (sq. mi)</th>
    </tr>
    <tr>
      <th>state</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Alabama</th>
      <td>AL</td>
      <td>total</td>
      <td>2010</td>
      <td>4785570.0</td>
      <td>52423.0</td>
    </tr>
    <tr>
      <th>Alaska</th>
      <td>AK</td>
      <td>total</td>
      <td>2010</td>
      <td>713868.0</td>
      <td>656425.0</td>
    </tr>
    <tr>
      <th>Arizona</th>
      <td>AZ</td>
      <td>total</td>
      <td>2010</td>
      <td>6408790.0</td>
      <td>114006.0</td>
    </tr>
    <tr>
      <th>Arkansas</th>
      <td>AR</td>
      <td>total</td>
      <td>2010</td>
      <td>2922280.0</td>
      <td>53182.0</td>
    </tr>
    <tr>
      <th>California</th>
      <td>CA</td>
      <td>total</td>
      <td>2010</td>
      <td>37333601.0</td>
      <td>163707.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
# 计算人口密度。注意是Series/Series，其结果还是一个Series
```


```python
density = data2010['population'].div(data2010['area (sq. mi)']) #出发运算
display(data2010.shape,type(data2010),type(df2),density.head(),type(density))
```


    (52, 5)



    pandas.core.frame.DataFrame



    pandas.core.frame.DataFrame



    state
    Alabama        91.287603
    Alaska          1.087509
    Arizona        56.214497
    Arkansas       54.948667
    California    228.051342
    dtype: float64



    pandas.core.series.Series



```python
# 排序，并找出人口密度最高的五个州
```


```python
display(density.sort_values(ascending=False,inplace = False).head())
```


    state
    District of Columbia    8898.897059
    Puerto Rico             1058.665149
    New Jersey              1009.253268
    Rhode Island             681.339159
    Connecticut              645.600649
    dtype: float64



```python
# 排序，并找出人口密度最低的五个州
```


```python
display(density.sort_values(ascending=False).tail())
```


    state
    South Dakota    10.583512
    North Dakota     9.537565
    Montana          6.736171
    Wyoming          5.768079
    Alaska           1.087509
    dtype: float64



```python
# 要点总结：
# 统一用loc()索引
# 善于使用.isnull().any()找到存在NaN的列
# 善于使用.unique()确定该列中哪些key是我们需要的
# 一般使用外合并、左合并，目的只有一个：宁愿该列是NaN也不要丢弃其他列的信息
```
